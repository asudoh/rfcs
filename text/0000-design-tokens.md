- Start Date: 2018-02-26
- RFC PR:
- Carbon Issue: https://github.com/carbon-design-system/carbon-themes/pull/27#issue-169200892

# Summary

Introduce "design tokens", variables that can be shared among different types of our source code, e.g. `.scss`, `.js` and HTML templats.

# Basic example

## Design tokens reused for other design tokens (aliases)

e.g. Brand prefix:

```yaml
aliases:
  prefix:
    value: "bx"
```

e.g. Theming:

```yaml
imports:
  - ./colors.yml
global:
  type: color
  category: theme
props:
  brand-01:
    value: "{!color__blue-51}"
  …
```

e.g. Component name, combined with brand prefix (via `imports`):

```yaml
imports:
  - ../../globals/tokens/brand.yml
aliases:
  name:
    value: "accordion"
```

## Design token for a component

e.g. CSS classes:

```yaml
imports:
  - ./_accordion.yml
global:
  type: class
  category: component
props:
  base:
    value: "{!prefix}--{!name}"
  item:
    value: "{!prefix}--{!name}__item"
  item-active:
    value: "{!prefix}--{!name}__item--active"
  …
```

## Using design tokens

e.g. in component `.scss`:

```scss
// Generated by build process from design tokens
@import 'scss/components/accordion/accordion--classes';

@include exports('accordion') {
  .#{map-get($accordion--classes, "base")} {
    color: $ui-01;
    …
  }
  …
}
```

e.g. in vanilla component `.js`:

**Note**: A build step generates `classActive` property below from `item-active` class token, for backward-compatibility sake (Explained [later](#compatibility-layer-for-component-classselector-tokens))

```javascript
class Accordion extends mixin(…) {
  …

  _toggle(element) {
    …

    element.classList.toggle(this.options.classActive);
  }

  …
}
```

e.g. in React component `.js`:

```javascript
import React, { Component } from 'react';
import cssClasses from './accordion--classes.json';

…

class Accordion extends Component {
  render() {
    …

    const { 'item-active': classItemActive, classItem } = cssClasses;
    const classNames = classnames(
      {
        classItemActive: this.state.open,
      },
      classItem,
      className
    );
    
    …
  }
}
```

# Motivation

The biggest motivation is for [brand prefixing](https://github.com/carbon-design-system/carbon-components/pull/492) support in our [`carbon-components-react`](https://github.com/carbon-design-system/carbon-components-react) codebase. Unlike our [vanilla](https://github.com/carbon-design-system/carbon-components) codebase, `carbon-components-react` hard-codes all CSS classes, which makes us require one-step abstraction (making them variables) for brand prefixing support.

The design token notion takes another step of the abstraction, making brand prefix, etc. variables reusable across different types of artifacts in our codebase, especially our `.scss`, `.js` and HTML template files.

# Detailed design

This spec defines several different categories of design tokens:

* [Global aliases](#global-aliases): Define anything that are shared among multiple tokens files
* [Global tokens](#global-tokens): Used primary for global theming
* [Component aliases](#component-aliases): Define things that are shared among multiple token files for the component
* [Component class tokens](#component-class-tokens): Allows us to reuse CSS class names among `.scss`, `.js` and HTML template files
* [Component selector tokens](#component-selector-tokens): Primary for our vanilla codebase, abstracting different DOM structure from different HTML templates for themes

Carbon Design System implementation may add other types of design tokens as needed.

## Global aliases

Global aliases define anything that are shared among multiple tokens files, e.g. brand prefix:

```yaml
aliases:
  prefix:
    value: "bx"
```

## Global tokens

Global tokens are used primary for theming:

```yaml
imports:
  - ./colors.yml
global:
  type: color
  category: theme
props:
  brand-01:
    value: "{!color__blue-51}"
  brand-02:
    value: "{!color__blue-40}"
  brand-03:
    value: "{!color__teal-20}"
  …
```

Given `carbon-components/src/globals/tokens/color-theme.yaml` as the file name for above, the build toolchain generates `carbon-components/scss/globals/tokens/color-theme.scss`, like below, replacing the corresponding ones in Carbon [`_vars.scss`](https://github.com/carbon-design-system/carbon-components/blob/db4e058/src/globals/scss/_vars.scss#L23-L48):

```scss
$brand-01: rgb(61, 112, 178) !default;
$brand-02: rgb(85, 150, 230) !default;
$brand-03: rgb(110, 237, 216) !default;
…
```

Such generated `.scss`, as the path indicates, will be included in `carbon-components` NPM package.

## Component aliases

Component aliases define things that are shared among multiple token files for the component, e.g. component name:

```yaml
imports:
  - ../../globals/tokens/brand.yml
aliases:
  name:
    value: "accordion"
```

## Component class tokens

Component class tokens are for CSS classes for specific components. Given `carbon-components/src/components/accordion/accordion-classes.yaml`:

```yaml
imports:
  - ./_accordion.yml
global:
  type: class
  category: component
props:
  base:
    value: "{!prefix}--{!name}"
  …
  item-active:
    value: "{!prefix}--{!name}__item--active"
  …
```

The build toolchain generates `carbon-components/scss/components/accordion/accordion--classes.scss` and `carbon-components/tokens/accordion/accordion--classes.json`, like below:


```scss
$accordion--classes: (
  'base': (bx--accordion),
  …
  'item-active': (bx--accordion__item--active),
  …
);
```

```json
{
  "base": "bx--accordion",
  …
  "item-active": "bx--accordion__item--active",
  …
}
```

Such generated `.scss`, as the path indicates, will be included in `carbon-components` NPM package. We also include any files in generated `tokens` directory in `carbon-components` NPM package so that `carbon-components-react` etc. can use those tokens.

## Component selector tokens

Component selector tokens are for CSS selectors for specific components, like:

```yaml
imports:
  - ./_accordion.yml
global:
  type: selector
  category: component
props:
  init:
    value: "[data-{!name}]"
  item:
    value: ".{!prefix}--{!name}__item"
  …
```

Component selector tokens are primary for our vanilla codebase, abstracting different DOM structure from different HTML templates for themes. Component selector tokens have very similar directory/naming structure to ones for [component class tokens](#component-class-tokens).

# Drawbacks

There are two possible drawbacks with introducing design tokens:

1. The added abstractions make the workflow of implementing design specs less intuitive and more cumbersome
2. The added build steps make the workflow of changing source code and checking the result slower, especially when a developer changes values of design tokens

# Alternatives

A major design alternative would be maintaining separate tokens for different file type, i.e. Sass variables and JSON (or JavaScript module). This approach has much less tooling overhead, though it may be cumbersome for developers to maintain a same token for different file types.

Minor design alternatives are:

* Geneting Sass map from global tokens, i.e. `color: map-get($carbon-theme, "ui-01")`. While it'd further reduce the risk of naming collision, it'd be a breaking change for project referring to Carbon Sass variables directly. Also, it'd be cumbersome having to use Sass map function just to refer to the theme variables.
* Geneting name-prefixed Sass variables from component tokens, i.e. `.#{$accordion--base}` insteaad of `.#{map-get($accordion--classes, "base")}`. While this may end up with longer variable name that may be cumbersome, the variable would be easier to access for developers.
* Converting every variable seen in `.scss` to a design token, e.g. `$carbon--ease-in`, `$input-border`, etc. While doing so eliminates "what should be in YAML design tokens?" question, JSON generated from such tokens will be useless.

# Adoption strategy

`carbon-components` changes to introduce design tokens should keep backward-compatibility wherever possible. One example is global tokens; Global tokens corresponding to Sass variables that use to be existing `.scss` files are referred from them so that existing Sass imports for variables work. Another backward-compaibility layer is suggested for vanilla JavaScript, mentioned [later](#compatibility-layer-for-component-classselector-tokens).

## `carbon-components` NPM package

All generated artifacts from the YAML design tokens should be included in `carbon-components` NPM package so that they can be used for `carbon-components-react`, etc.

## Themes repo

[`carbon-themes`](https://github.com/carbon-design-system/carbon-themes) should introduce the similar toolchain to what this spec suggests, so that the theme artifacts can be generated from YAML design tokens to different formats.

## Compatibility layer for component class/selector tokens

As of today, vanilla codebase maintains class/selector tokens in static `.options` property, like the following:

```javascript
import settings from '../../globals/js/settings';

…

class Accordion extends mixin(…) {
  …

  static get options() {
    const { prefix } = settings;
    return {
      selectorInit: '[data-accordion]',
      selectorAccordionItem: `.${prefix}--accordion__item`,
      …
      classActive: `${prefix}--accordion__item--active`,
    };
  }

  …
}
```

This spec suggests that we define additional build step to generate a similar data structure like above from [component class tokens](#component-class-tokens) and [component selector tokens](#component-selector-tokens), as an efficient way to preserve the backward compatibility. For example, such additional build step can define the following conversion table:

```javascript
accordion: {
  classes: {
    'item-active': 'classActive',
  },
  selectors: {
    init: 'selectorInit',
    item: 'selectorAccordionItem',
    …
  },
},
```

And generate `accordion.json` from `accordion--classes.json` and `accordion--selectors.json` with above table, and can be used like below:

```javascript
import defaultOptions from '../../../tokens/accordion/accordion.json';

…

class Accordion extends mixin(…) {
  …

  static options = defaultOptions;

  …
}
```

# How we teach this

There is a minor breaking change where our generated `.scss` files refer to `carbon-components/scss/globals/tokens`. We need to advertise that apps using our `.scss` files should update `includePath` settting in their Sass build tool.

Another thing that's good to document is how to create themes in design tokens YAML files.

# Unresolved questions

Whether we want to maintain design tokens and their associated toolchain in a separate repository/package (from our vanilla repository/package) or in [`carbon-themes`](https://github.com/carbon-design-system/carbon-themes) repo is a good thing to discuss.
